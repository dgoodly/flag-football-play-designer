<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flag Football Play Designer - Module 2: Draggable Players</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .app-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 30px;
            max-width: 100%;
            overflow: auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .field-container {
            position: relative;
            margin: 0 auto;
            border: 4px solid #2c3e50;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            background: #27ae60;
            width: 1920px;
            height: 1080px;
            max-width: 100%;
            max-height: 80vh;
        }

        .field {
            width: 100%;
            height: 100%;
            position: relative;
            background: 
                linear-gradient(to right, rgba(255, 255, 255, 0.1) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 30px 30px;
            background-position: 0 0;
        }

        /* Field markings */
        .field::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(to right, 
                    transparent 0%, 
                    rgba(255, 255, 255, 0.8) 0%, 
                    rgba(255, 255, 255, 0.8) 2px, 
                    transparent 2px,
                    transparent 10%,
                    rgba(255, 255, 255, 0.8) 10%, 
                    rgba(255, 255, 255, 0.8) 12px, 
                    transparent 12px,
                    transparent 20%,
                    rgba(255, 255, 255, 0.8) 20%, 
                    rgba(255, 255, 255, 0.8) 22px, 
                    transparent 22px,
                    transparent 30%,
                    rgba(255, 255, 255, 0.8) 30%, 
                    rgba(255, 255, 255, 0.8) 32px, 
                    transparent 32px,
                    transparent 40%,
                    rgba(255, 255, 255, 0.8) 40%, 
                    rgba(255, 255, 255, 0.8) 42px, 
                    transparent 42px,
                    transparent 50%,
                    rgba(255, 255, 255, 0.8) 50%, 
                    rgba(255, 255, 255, 0.8) 52px, 
                    transparent 52px,
                    transparent 60%,
                    rgba(255, 255, 255, 0.8) 60%, 
                    rgba(255, 255, 255, 0.8) 62px, 
                    transparent 62px,
                    transparent 70%,
                    rgba(255, 255, 255, 0.8) 70%, 
                    rgba(255, 255, 255, 0.8) 72px, 
                    transparent 72px,
                    transparent 80%,
                    rgba(255, 255, 255, 0.8) 80%, 
                    rgba(255, 255, 255, 0.8) 82px, 
                    transparent 82px,
                    transparent 90%,
                    rgba(255, 255, 255, 0.8) 90%, 
                    rgba(255, 255, 255, 0.8) 92px, 
                    transparent 92px,
                    transparent 100%
                ),
                linear-gradient(to right, 
                    transparent 49%, 
                    rgba(255, 255, 255, 1) 49%, 
                    rgba(255, 255, 255, 1) 51%, 
                    transparent 51%
                );
        }

        /* Player styles */
        .player {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid #fff;
            cursor: grab;
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            z-index: 10;
        }

        .player:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }

        .player.dragging {
            cursor: grabbing;
            transform: scale(1.2);
            z-index: 100;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
        }

        .player.fixed {
            cursor: not-allowed;
            opacity: 0.8;
        }

        .player.fixed:hover {
            transform: none;
        }

        /* Player types */
        .player.center {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .player.qb {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .player.wr {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .player.rb {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }

        .player.te {
            background: linear-gradient(135deg, #1abc9c, #16a085);
        }

        /* Player labels */
        .player-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            white-space: nowrap;
            pointer-events: none;
        }

        /* Controls */
        .controls {
            margin-top: 20px;
            text-align: center;
        }

        .control-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 0 10px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .control-btn.secondary {
            background: #95a5a6;
        }

        .control-btn.secondary:hover {
            background: #7f8c8d;
        }

        /* Formation selector */
        .formation-selector {
            margin: 20px 0;
            text-align: center;
        }

        .formation-selector select {
            padding: 10px 20px;
            border: 2px solid #3498db;
            border-radius: 25px;
            font-size: 16px;
            background: white;
            cursor: pointer;
        }

        /* Info panel */
        .info-panel {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }

        .info-panel h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .info-panel p {
            color: #666;
            line-height: 1.6;
        }

        /* Responsive design */
        @media (max-width: 2000px) {
            .field-container {
                transform: scale(0.8);
                transform-origin: center;
            }
        }

        @media (max-width: 1600px) {
            .field-container {
                transform: scale(0.6);
                transform-origin: center;
            }
        }

        @media (max-width: 1200px) {
            .field-container {
                transform: scale(0.4);
                transform-origin: center;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .field-container {
                transform: scale(0.3);
                transform-origin: center;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>üèà Flag Football Play Designer</h1>
            <p>Module 2: Draggable Players with Constraints</p>
        </div>

        <div class="formation-selector">
            <label for="formationSelect">Select Formation: </label>
            <select id="formationSelect" onchange="changeFormation()">
                <option value="6v6-spread">6v6 Spread Formation</option>
                <option value="6v6-tight">6v6 Tight Formation</option>
                <option value="5v5-spread">5v5 Spread Formation</option>
                <option value="7v7-spread">7v7 Spread Formation</option>
            </select>
        </div>

        <div class="field-container">
            <div class="field" id="field">
                <!-- Players will be dynamically added here -->
            </div>
        </div>

        <div class="controls">
            <button class="control-btn" onclick="resetFormation()">Reset Formation</button>
            <button class="control-btn" onclick="showPlayerPositions()">Show Positions</button>
            <button class="control-btn secondary" onclick="toggleConstraints()">Toggle Constraints</button>
        </div>

        <div class="info-panel">
            <h3>Module 2 Features:</h3>
            <p>
                ‚úÖ 5-7 draggable players with different positions<br>
                ‚úÖ Grid snapping when dragging<br>
                ‚úÖ Center player is fixed and cannot be moved<br>
                ‚úÖ Players cannot move above the center player<br>
                ‚úÖ Touch and mouse drag support<br>
                ‚úÖ Multiple formation presets<br>
                ‚úÖ Visual feedback during dragging<br>
                ‚úÖ Player position constraints and validation
            </p>
        </div>
    </div>

    <script>
        /**
         * Module 2: Draggable Players System
         * 
         * This module provides:
         * - Draggable player pieces that snap to grid
         * - Position constraints (center fixed, no movement above center)
         * - Touch and mouse support
         * - Multiple formation presets
         * - Visual feedback and validation
         */

        class DraggablePlayerSystem {
            constructor() {
                this.fieldWidth = 1920;
                this.fieldHeight = 1080;
                this.gridSize = 30;
                this.field = document.getElementById('field');
                this.players = new Map();
                this.constraintsEnabled = true;
                this.centerPlayer = null;
                this.draggedPlayer = null;
                this.dragOffset = { x: 0, y: 0 };
                
                this.initializePlayers();
                this.setupEventListeners();
            }

            /**
             * Initialize players with default formation
             */
            initializePlayers() {
                this.clearPlayers();
                this.createFormation('6v6-spread');
                console.log('Draggable Player System initialized');
            }

            /**
             * Create a formation with specified players
             * @param {string} formationType - Type of formation to create
             */
            createFormation(formationType) {
                const formations = {
                    '6v6-spread': {
                        center: { x: 960, y: 540, type: 'center', label: 'C' },
                        qb: { x: 900, y: 540, type: 'qb', label: 'QB' },
                        wr1: { x: 600, y: 300, type: 'wr', label: 'WR1' },
                        wr2: { x: 600, y: 780, type: 'wr', label: 'WR2' },
                        wr3: { x: 300, y: 420, type: 'wr', label: 'WR3' },
                        wr4: { x: 300, y: 660, type: 'wr', label: 'WR4' }
                    },
                    '6v6-tight': {
                        center: { x: 960, y: 540, type: 'center', label: 'C' },
                        qb: { x: 900, y: 540, type: 'qb', label: 'QB' },
                        te1: { x: 720, y: 420, type: 'te', label: 'TE1' },
                        te2: { x: 720, y: 660, type: 'te', label: 'TE2' },
                        wr1: { x: 480, y: 360, type: 'wr', label: 'WR1' },
                        wr2: { x: 480, y: 720, type: 'wr', label: 'WR2' }
                    },
                    '5v5-spread': {
                        center: { x: 960, y: 540, type: 'center', label: 'C' },
                        qb: { x: 900, y: 540, type: 'qb', label: 'QB' },
                        wr1: { x: 600, y: 300, type: 'wr', label: 'WR1' },
                        wr2: { x: 600, y: 780, type: 'wr', label: 'WR2' },
                        rb: { x: 720, y: 540, type: 'rb', label: 'RB' }
                    },
                    '7v7-spread': {
                        center: { x: 960, y: 540, type: 'center', label: 'C' },
                        qb: { x: 900, y: 540, type: 'qb', label: 'QB' },
                        wr1: { x: 600, y: 240, type: 'wr', label: 'WR1' },
                        wr2: { x: 600, y: 840, type: 'wr', label: 'WR2' },
                        wr3: { x: 300, y: 360, type: 'wr', label: 'WR3' },
                        wr4: { x: 300, y: 720, type: 'wr', label: 'WR4' },
                        rb: { x: 720, y: 480, type: 'rb', label: 'RB' }
                    }
                };

                const formation = formations[formationType];
                if (!formation) {
                    console.error('Unknown formation type:', formationType);
                    return;
                }

                Object.entries(formation).forEach(([id, config]) => {
                    this.createPlayer(id, config.x, config.y, config.type, config.label);
                });

                this.centerPlayer = this.players.get('center');
            }

            /**
             * Create a draggable player
             * @param {string} id - Unique player ID
             * @param {number} x - X position
             * @param {number} y - Y position
             * @param {string} type - Player type (center, qb, wr, etc.)
             * @param {string} label - Display label
             */
            createPlayer(id, x, y, type, label) {
                const player = document.createElement('div');
                player.className = `player ${type}`;
                player.id = id;
                player.textContent = label;
                player.style.left = `${x}px`;
                player.style.top = `${y}px`;

                // Add label
                const labelElement = document.createElement('div');
                labelElement.className = 'player-label';
                labelElement.textContent = label;
                player.appendChild(labelElement);

                // Make center player fixed
                if (type === 'center') {
                    player.classList.add('fixed');
                }

                this.field.appendChild(player);
                this.players.set(id, {
                    element: player,
                    type: type,
                    label: label,
                    x: x,
                    y: y
                });
            }

            /**
             * Clear all players from the field
             */
            clearPlayers() {
                this.players.forEach((player) => {
                    player.element.remove();
                });
                this.players.clear();
                this.centerPlayer = null;
            }

            /**
             * Snap coordinates to grid
             * @param {number} x - X coordinate
             * @param {number} y - Y coordinate
             * @returns {Object} - Snapped coordinates
             */
            snapToGrid(x, y) {
                const snappedX = Math.round(x / this.gridSize) * this.gridSize;
                const snappedY = Math.round(y / this.gridSize) * this.gridSize;
                
                const clampedX = Math.max(0, Math.min(snappedX, this.fieldWidth - 40));
                const clampedY = Math.max(0, Math.min(snappedY, this.fieldHeight - 40));
                
                return { x: clampedX, y: clampedY };
            }

            /**
             * Check if player position is valid
             * @param {string} playerId - Player ID
             * @param {number} x - X coordinate
             * @param {number} y - Y coordinate
             * @returns {boolean} - True if position is valid
             */
            isValidPosition(playerId, x, y) {
                if (!this.constraintsEnabled) return true;

                const player = this.players.get(playerId);
                if (!player) return false;

                // Center player cannot be moved
                if (player.type === 'center') return false;

                // No player can move above the center player
                if (this.centerPlayer && y < this.centerPlayer.y) {
                    return false;
                }

                // Check for collisions with other players
                for (const [id, otherPlayer] of this.players) {
                    if (id === playerId) continue;
                    
                    const distance = Math.sqrt(
                        Math.pow(x - otherPlayer.x, 2) + Math.pow(y - otherPlayer.y, 2)
                    );
                    
                    if (distance < 60) { // Minimum distance between players
                        return false;
                    }
                }

                return true;
            }

            /**
             * Update player position
             * @param {string} playerId - Player ID
             * @param {number} x - New X coordinate
             * @param {number} y - New Y coordinate
             */
            updatePlayerPosition(playerId, x, y) {
                const player = this.players.get(playerId);
                if (!player) return;

                const snapped = this.snapToGrid(x, y);
                
                if (this.isValidPosition(playerId, snapped.x, snapped.y)) {
                    player.x = snapped.x;
                    player.y = snapped.y;
                    player.element.style.left = `${snapped.x}px`;
                    player.element.style.top = `${snapped.y}px`;
                }
            }

            /**
             * Setup event listeners for dragging
             */
            setupEventListeners() {
                // Mouse events
                this.field.addEventListener('mousedown', this.handleMouseDown.bind(this));
                document.addEventListener('mousemove', this.handleMouseMove.bind(this));
                document.addEventListener('mouseup', this.handleMouseUp.bind(this));

                // Touch events
                this.field.addEventListener('touchstart', this.handleTouchStart.bind(this), { passive: false });
                document.addEventListener('touchmove', this.handleTouchMove.bind(this), { passive: false });
                document.addEventListener('touchend', this.handleTouchEnd.bind(this));
            }

            /**
             * Handle mouse down event
             * @param {MouseEvent} e - Mouse event
             */
            handleMouseDown(e) {
                const player = e.target.closest('.player');
                if (!player || player.classList.contains('fixed')) return;

                e.preventDefault();
                this.startDrag(player, e.clientX, e.clientY);
            }

            /**
             * Handle mouse move event
             * @param {MouseEvent} e - Mouse event
             */
            handleMouseMove(e) {
                if (!this.draggedPlayer) return;

                e.preventDefault();
                this.updateDrag(e.clientX, e.clientY);
            }

            /**
             * Handle mouse up event
             * @param {MouseEvent} e - Mouse event
             */
            handleMouseUp(e) {
                if (!this.draggedPlayer) return;

                e.preventDefault();
                this.endDrag();
            }

            /**
             * Handle touch start event
             * @param {TouchEvent} e - Touch event
             */
            handleTouchStart(e) {
                const touch = e.touches[0];
                const player = document.elementFromPoint(touch.clientX, touch.clientY)?.closest('.player');
                
                if (!player || player.classList.contains('fixed')) return;

                e.preventDefault();
                this.startDrag(player, touch.clientX, touch.clientY);
            }

            /**
             * Handle touch move event
             * @param {TouchEvent} e - Touch event
             */
            handleTouchMove(e) {
                if (!this.draggedPlayer) return;

                e.preventDefault();
                const touch = e.touches[0];
                this.updateDrag(touch.clientX, touch.clientY);
            }

            /**
             * Handle touch end event
             * @param {TouchEvent} e - Touch event
             */
            handleTouchEnd(e) {
                if (!this.draggedPlayer) return;

                e.preventDefault();
                this.endDrag();
            }

            /**
             * Start dragging a player
             * @param {HTMLElement} player - Player element
             * @param {number} clientX - Client X coordinate
             * @param {number} clientY - Client Y coordinate
             */
            startDrag(player, clientX, clientY) {
                this.draggedPlayer = player;
                player.classList.add('dragging');

                const rect = this.field.getBoundingClientRect();
                const playerRect = player.getBoundingClientRect();
                
                this.dragOffset.x = clientX - playerRect.left;
                this.dragOffset.y = clientY - playerRect.top;
            }

            /**
             * Update drag position
             * @param {number} clientX - Client X coordinate
             * @param {number} clientY - Client Y coordinate
             */
            updateDrag(clientX, clientY) {
                if (!this.draggedPlayer) return;

                const rect = this.field.getBoundingClientRect();
                const x = clientX - rect.left - this.dragOffset.x;
                const y = clientY - rect.top - this.dragOffset.y;

                this.draggedPlayer.style.left = `${x}px`;
                this.draggedPlayer.style.top = `${y}px`;
            }

            /**
             * End dragging
             */
            endDrag() {
                if (!this.draggedPlayer) return;

                const playerId = this.draggedPlayer.id;
                const x = parseInt(this.draggedPlayer.style.left);
                const y = parseInt(this.draggedPlayer.style.top);

                this.updatePlayerPosition(playerId, x, y);
                
                this.draggedPlayer.classList.remove('dragging');
                this.draggedPlayer = null;
            }

            /**
             * Get all player positions
             * @returns {Object} - Object with player positions
             */
            getPlayerPositions() {
                const positions = {};
                this.players.forEach((player, id) => {
                    positions[id] = {
                        x: player.x,
                        y: player.y,
                        type: player.type,
                        label: player.label
                    };
                });
                return positions;
            }

            /**
             * Set player positions
             * @param {Object} positions - Object with player positions
             */
            setPlayerPositions(positions) {
                Object.entries(positions).forEach(([id, pos]) => {
                    if (this.players.has(id)) {
                        this.updatePlayerPosition(id, pos.x, pos.y);
                    }
                });
            }

            /**
             * Toggle position constraints
             */
            toggleConstraints() {
                this.constraintsEnabled = !this.constraintsEnabled;
                console.log('Constraints', this.constraintsEnabled ? 'enabled' : 'disabled');
            }
        }

        // Initialize the draggable player system
        const playerSystem = new DraggablePlayerSystem();

        // Global functions for controls
        function changeFormation() {
            const select = document.getElementById('formationSelect');
            playerSystem.createFormation(select.value);
        }

        function resetFormation() {
            const select = document.getElementById('formationSelect');
            playerSystem.createFormation(select.value);
        }

        function showPlayerPositions() {
            const positions = playerSystem.getPlayerPositions();
            console.log('Current player positions:', positions);
            
            let message = 'Current Player Positions:\n\n';
            Object.entries(positions).forEach(([id, pos]) => {
                message += `${pos.label}: (${pos.x}, ${pos.y})\n`;
            });
            
            alert(message);
        }

        function toggleConstraints() {
            playerSystem.toggleConstraints();
        }

        // Export for use by other modules
        window.DraggablePlayerSystem = DraggablePlayerSystem;
        window.playerSystem = playerSystem;
    </script>
</body>
</html>